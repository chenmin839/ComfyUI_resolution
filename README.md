# ComfyUI 图像比例选择插件

一个用于ComfyUI的自定义节点插件，提供预设的图像宽度和高度比例选择，方便快速设置常用的图像分辨率。

## 🚀 版本更新 v1.1.0

- 🎯 精简功能：移除复杂的高级节点，专注核心功能
- 💻 代码优化：添加类型提示，改进错误处理
- ⚙️ 配置外置：预设分辨率可通过配置文件管理
- 📊 性能提升：增加缓存机制，优化解析速度

## 功能特点

- 🎯 **预设分辨率选择**: 无需记忆或手动输入分辨率数字
- 📱 **iPhone设备分辨率**: 包含iPhone各代设备的屏幕分辨率
- 🖼️ **SD模型优化**: 专门为Stable Diffusion 1.5和SDXL优化的分辨率
- 📺 **社交媒体格式**: Instagram、TikTok、YouTube等平台常用尺寸
- 🎬 **视频分辨率**: HD、Full HD、4K等视频制作标准
- ✅ **VAE兼容**: 所有分辨率都确保是8的倍数，避免VAE解码错误
- 🔧 **双模式支持**: 预设分辨率 + 自定义尺寸
- 📝 **类型安全**: 完整的Python类型提示支持

## 安装方法

1. 将整个插件文件夹复制到ComfyUI的`custom_nodes`目录下
2. 重启ComfyUI
3. 在节点菜单的`latent`分类下找到"Cm Latent Image"节点

## 使用方法

1. 在ComfyUI工作流中右键 → `latent` → `Cm Latent Image`
2. 选择模式：
   - **预设分辨率**: 从下拉菜单选择常用分辨率
   - **自定义尺寸**: 手动输入宽度和高度
3. 设置batch_size（批处理数量）
4. 连接到KSampler或其他需要latent输入的节点

## 预设分辨率列表

### SD 1.5 分辨率 (512基础)
- 512x512 (1:1) 正方形
- 512x768 (2:3) 竖版
- 768x512 (3:2) 横版
- 512x896 (4:7) 竖屏
- 896x512 (7:4) 横屏
- 640x512 (5:4) 接近4:3
- 512x640 (4:5) 接近3:4
- 768x768 (1:1) 大正方形

### SDXL 分辨率 (1024基础)
- 1024x1024 (1:1) 正方形
- 832x1216 (2:3) 竖版
- 1216x832 (3:2) 横版
- 768x1344 (4:7) 竖屏
- 1344x768 (7:4) 横屏
- 896x1152 (7:9) iPhone比例
- 1152x896 (9:7) iPhone横屏
- 1024x1536 (2:3) 高竖版
- 1536x1024 (3:2) 宽横版

### iPhone 设备分辨率
- 480x320 (3:2) iPhone早期
- 1136x640 (16:9) iPhone5系列
- 1344x752 (16:9) iPhone6/7/8
- 1024x472 (19.5:9) iPhoneX系列缩放
- 2048x944 (19.5:9) iPhoneX高清

### 社交媒体格式
- 1080x1080 (1:1) Instagram正方形
- 1080x1350 (4:5) Instagram竖版
- 1920x1080 (16:9) YouTube横屏
- 1080x1920 (9:16) TikTok竖屏

### 视频标准分辨率
- 1280x720 (16:9) HD
- 1920x1080 (16:9) Full HD
- 2560x1440 (16:9) 2K
- 3840x2160 (16:9) 4K

### 其他常用比例
- 1024x768 (4:3) 经典比例
- 1280x1024 (5:4) 接近正方形
- 1600x900 (16:9) 宽屏
- 1440x900 (8:5) Mac风格

## 技术细节

- **输出类型**: LATENT (与原生EmptyLatentImage兼容)
- **分辨率处理**: 自动确保所有尺寸都是8的倍数
- **Latent尺寸**: 图像尺寸除以8 (VAE编码比例)
- **批处理支持**: 支持1-4096的batch_size
- **类型安全**: 完整的Python类型提示
- **错误处理**: 智能回退机制，确保稳定运行
- **性能优化**: LRU缓存，避免重复解析

## 与原生节点的区别

| 特性 | 原生EmptyLatentImage | Cm Latent Image |
|------|----------------------|-----------------|
| 输入方式 | 手动输入宽度和高度 | 预设选择 + 自定义输入 |
| 使用便利性 | 需要记忆分辨率数字 | 直观的比例和用途描述 |
| 错误预防 | 可能输入非8倍数 | 自动确保VAE兼容 |
| 预设丰富度 | 无预设 | 40+常用分辨率预设 |
| 代码质量 | 基础实现 | 类型安全 + 错误处理 |

## 文件结构

```
ComfyUI_resolution/
├── __init__.py          # 节点注册
├── nodes.py             # 主节点实现 (优化版)
├── config.py            # 配置文件 (新增)
├── README.md           # 项目说明
├── INSTALL.md          # 安装指南
└── example_workflow.json # 示例工作流
```

## 常见问题

**Q: 这个插件会替代原生的EmptyLatentImage吗？**
A: 不会，它是一个补充节点。您仍然可以使用原生节点进行自定义尺寸输入。

**Q: 可以添加自定义分辨率吗？**
A: 可以！编辑`config.py`文件中的`RESOLUTION_PRESETS`列表即可添加新的预设分辨率。

**Q: 为什么某些iPhone分辨率被缩放了？**
A: iPhone的原始分辨率对于SD模型来说可能太大，插件提供了适合AI图像生成的缩放版本。

**Q: 代码出错时会怎样？**
A: 插件具有智能回退机制，如果解析失败会自动使用默认的1024x1024分辨率，确保不会中断工作流。

## 更新日志

### v1.1.0 (当前版本)
- 🗑️ 删除高级节点，专注核心功能
- 💻 重构代码，添加类型提示
- ⚙️ 配置外置，便于维护
- 📊 性能优化，增加缓存
- 🛡️ 改进错误处理和日志

### v1.0.0
- 初始版本发布
- 包含50+预设分辨率
- 支持SD1.5、SDXL、iPhone、社交媒体和视频格式

## 技术支持

如有问题或建议，请在GitHub项目页面提交Issue。

## 许可证

MIT License 